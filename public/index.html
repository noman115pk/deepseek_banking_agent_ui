<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banking & Finance Agent</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <h1 class="mb-4 text-center">Banking & Finance Agent</h1>

    <div class="mb-3">
      <label for="examplePrompts" class="form-label">Example Prompts:</label>
      <select class="form-select" id="examplePrompts" onchange="insertExample()">
        <option selected disabled>Select an example prompt</option>
      </select>

      <script>
        async function loadPrompts() {
          try {
        const res = await fetch('/api/prompts');
        const prompts = await res.json();
        const select = document.getElementById('examplePrompts');
        
        prompts.forEach(prompt => {
          const option = document.createElement('option');
          option.value = prompt.text;
          option.textContent = prompt.title;
          select.appendChild(option);
        });
          } catch (error) {
        console.error('Failed to load prompts:', error);
          }
        }

        // Load prompts when page loads
        document.addEventListener('DOMContentLoaded', loadPrompts);
      </script>
    </div>

    <div class="mb-3">
      <label for="userInput" class="form-label">Enter your question:</label>
      <textarea class="form-control" id="userInput" rows="4" placeholder="Ask a question about banking or finance..."></textarea>
    </div>

    <div class="d-grid gap-2">
      <button class="btn btn-primary" onclick="sendQuery()">Ask</button>
    </div>

    <div class="text-center mt-3" id="spinner" style="display: none;">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <div class="mt-4">
      <h5>Response:</h5>
      <div id="response" class="border p-3 bg-light" style="min-height: 100px;"></div>
    </div>
  </div>

  <script>
    function insertExample() {
      const example = document.getElementById('examplePrompts').value;
      document.getElementById('userInput').value = example;
    }

    async function sendQuery() {
      const message = document.getElementById('userInput').value;
      document.getElementById('spinner').style.display = 'block';
      document.getElementById('response').innerText = '';

      const res = await fetch('/api/query', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message })
      });

      const data = await res.json();
      document.getElementById('spinner').style.display = 'none';
      document.getElementById('response').innerText = data.reply || data.error;

      if (data.links && data.links.length > 0) {
        const list = document.createElement('ul');
        data.links.forEach(linkObj => {
          const item = document.createElement('li');
          const a = document.createElement('a');
          a.href = linkObj.url;
          a.target = '_blank';
          a.innerText = linkObj.title;
          item.appendChild(a);
          list.appendChild(item);
        });
        document.getElementById('response').appendChild(document.createElement('br'));
        document.getElementById('response').appendChild(list);
      }
    }
  </script>
</body>
</html>
